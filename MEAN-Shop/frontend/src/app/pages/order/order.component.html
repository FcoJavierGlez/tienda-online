<div class="container-fluid">
    <div class="container">
        <h2>Tramitar pedido</h2>
        <hr class="spartan">
        <form [formGroup]="order" (submit)="onSubmit($event)" *ngIf="order">
            <mat-tab-group> <!-- [selectedIndex]="1" -->
                <mat-tab label="Dirección"> <!-- disabled -->
                    <section class="mt-4">
                        <select name="" id="" class="form-select mx-auto" formControlName="address" (change)="addressChange()">
                            <option value="" *ngIf="!addressesList.length; else addresses" [selected]="true">
                                No hay direcciones disponibles
                            </option>
                            <ng-template #addresses>
                                <option [value]="address._id"
                                    *ngFor="let address of addressesList; index as i" [selected]="i == 0">
                                    Dirección {{ i + 1 }}: {{ address.address }}
                                </option>
                            </ng-template>
                        </select>
                        <div class="mt-3 option-selected" *ngIf="addressSelected; else noAddressSelected">
                            <h4>Dirección elegida</h4>
                            <ul>
                                <li><b>{{ addressSelected.name }}</b></li>
                                <li>{{ addressSelected.city }}, ({{ addressSelected.province }}) {{ addressSelected.address }}</li>
                                <li *ngIf="addressSelected.apartment !== 'undefined'">{{ addressSelected.apartment }}</li>
                                <li>{{ addressSelected.country }}</li>
                                <li>{{ addressSelected.phone }}</li>
                                <li>{{ addressSelected.zipCode }}</li>
                            </ul>
                        </div>
                        <ng-template #noAddressSelected>
                            <div class="mt-3 option-selected">
                            <h4>Dirección elegida</h4>
                                <p>-- No hay direcciones disponibles --</p>
                                <button class="btn btn-success" (click)="goTo('address')">Añadir dirección</button>
                            </div>
                        </ng-template>
                    </section>
                </mat-tab>
                <mat-tab label="Pago" [disabled]="!checkAddressSelected()">
                    <section>
                        <section class="mt-4">
                            <select name="" id="" class="form-select mx-auto" formControlName="payment" (change)="cardChange()">
                                <option value="" *ngIf="!creditCards.length; else creditCard" [selected]="true">
                                    No hay tarjetas disponibles
                                </option>
                                <ng-template #creditCard>
                                    <option [value]="card.id"
                                        *ngFor="let card of creditCards; index as i" [selected]="i == 0">
                                        Tarjeta {{ i + 1 }}: 
                                        {{ getInfoCard(card).type }}
                                        acabada en {{ card.cardNumber | creditCardLastNumbers }}
                                    </option>
                                </ng-template>
                            </select>
                            <div class="mt-3 option-selected" *ngIf="cardSelected; else noCard">
                                <h4>Tarjeta elegida</h4>
                                <ul>
                                    <li><b>{{ cardSelected.name }}</b></li>
                                    <li>{{ cardSelected.cardNumber }}</li>
                                    <li [ngClass]="cssCardExpired(cardSelected)">{{ cardSelected.month | normalizeDigits }}/{{ cardSelected.year }}</li>
                                </ul>
                            </div>
                            <ng-template #noCard>
                                <div class="mt-3 option-selected">
                                <h4>Tarjeta elegida</h4>
                                    <p>-- No hay tarjetas disponibles --</p>
                                    <button class="btn btn-success" (click)="goTo('payments')">Añadir tarjeta</button>
                                </div>
                            </ng-template>
                        </section>
                    </section>
                </mat-tab>
                <mat-tab label="Confirmación" [disabled]="!(checkAddressSelected() && checkPaymentSelected())">
                    <section>
                        <div class="order">
                            <textarea name="" id="" cols="30" rows="10"></textarea>
                        </div>
                        <button class="btn golden">Confirmar</button>
                    </section>
                </mat-tab>
              </mat-tab-group>
        </form>
    </div>
</div>
